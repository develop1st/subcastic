services:
  icecast:
    image: libretime/icecast:2.4.4
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      ICECAST_SOURCE_PASSWORD: ${ICECAST_SOURCE_PASSWORD:-sourcepass}
      ICECAST_ADMIN_PASSWORD: ${ICECAST_ADMIN_PASSWORD:-adminpass}
      ICECAST_PASSWORD: ${ICECAST_ADMIN_PASSWORD:-adminpass}
      ICECAST_RELAY_PASSWORD: ${ICECAST_RELAY_PASSWORD:-relaypass}
      ICECAST_HOSTNAME: ${ICECAST_HOSTNAME:-subcastic.local}
      ICECAST_LOCATION: ${ICECAST_LOCATION:-LAN}
      ICECAST_ADMIN_USERNAME: ${ICECAST_ADMIN_USERNAME:-admin}
      ICECAST_ADMIN_EMAIL: ${ICECAST_ADMIN_EMAIL:-admin@localhost}
    volumes:
      - ./icecast/icecast.xml:/etc/icecast2/icecast.xml:ro
      - ./state/icecast:/var/log/icecast2

  liquidsoap:
    image: savonet/liquidsoap:14b6d14
    restart: unless-stopped
    depends_on:
      - icecast
    ports:
      - "127.0.0.1:${LIQ_SERVER_PORT:-1234}:1234"
    environment:
      LIQ_ICECAST_HOST: ${LIQ_ICECAST_HOST:-icecast}
      LIQ_ICECAST_PORT: ${LIQ_ICECAST_PORT:-8000}
      LIQ_ICECAST_MOUNT: ${LIQ_ICECAST_MOUNT:-/radio.mp3}
      LIQ_ICECAST_PASSWORD: ${LIQ_ICECAST_PASSWORD:-sourcepass}
      LIQ_SERVER_PORT: ${LIQ_SERVER_PORT:-1234}
      LIQ_MUSIC_DIR: /media/music
      LIQ_JINGLES_DIR: /media/jingles
      LIQ_INSERTS_DIR: /media/inserts
      LIQ_BITRATE: ${LIQ_BITRATE:-128}
      LIQ_MUSIC_WEIGHT: ${LIQ_MUSIC_WEIGHT:-6}
      LIQ_TEST_MEDIA_MODE: "1"
    command: ["liquidsoap", "/etc/liquidsoap/radio.liq"]
    volumes:
      - ./liquidsoap/radio.liq:/etc/liquidsoap/radio.liq:ro
      - ./.local/test-media/music:/media/music:ro
      - ./.local/test-media/jingles:/media/jingles:ro
      - ./.local/test-media/inserts:/media/inserts:ro
      - ./state:/state
